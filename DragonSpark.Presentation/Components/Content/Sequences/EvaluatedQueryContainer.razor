@using DragonSpark.Application.AspNet.Entities.Queries.Runtime.Pagination
@using DragonSpark.Application.AspNet.Entities.Queries.Runtime.Shape
@using DragonSpark.Compose
@using DragonSpark.Model.Operations.Results

@typeparam T

@inherits Templates.ManyActiveContentTemplateComponentBase<Page<T>>

<ResultingContentView Content="@_subject"
                      LoadingTemplate="@LoadingTemplate"
                      NotFoundTemplate="@NotFoundTemplate"
                      ExceptionTemplate="@ExceptionTemplate">
    @if (context.Count > 0)
    {
        @ChildContent(context)
    }
    else
    {
        @EmptyElementsTemplate
    }
</ResultingContentView>

@code {
    IResulting<Page<T>>? _subject;
    IPages<T>            _input = null!;
    bool                 _includeTotalCount;
    string?              _orderBy, _filter;
    Partition?           _partition;

    [Parameter]
    public IPages<T> Input
    {
        get => _input;
        set
        {
            if (_input != value)
            {
                _input   = value;
                _subject = null;
            }
        }
    }

    [Parameter]
    public bool IncludeTotalCount
    {
        get => _includeTotalCount;
        set
        {
            if (_includeTotalCount != value)
            {
                _includeTotalCount = value;
                _subject           = null;
            }
        }
    }

    [Parameter]
    public string? OrderBy
    {
        get => _orderBy;
        set
        {
            if (_orderBy != value)
            {
                _orderBy = value;
                _subject = null;
            }
        }
    }

    [Parameter]
    public string? Filter
    {
        get => _filter;
        set
        {
            if (_filter != value)
            {
                _filter  = value;
                _subject = null;
            }
        }
    }

    [Parameter]
    public Partition? Partition
    {
        get => _partition;
        set
        {
            if (_partition != value)
            {
                _partition = value;
                _subject   = null;
            }
        }
    }

    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        _subject ??= Input.Then().Bind(new PageInput(IncludeTotalCount, OrderBy, Filter, Partition)).Out();
    }
}