@using DragonSpark.Compose
@using DragonSpark.Presentation.Components.Content.Templates
@using System.Threading

@typeparam TInstance where TInstance : class
@typeparam T

@inherits ContentComponentBase<T>

@inject TInstance Instance

<ApplicationContentView TValue="T" Content="@Content" ChildContent="@ChildContent" NotFoundTemplate="@NotFoundTemplate" />

@code {

    [Parameter]
    public required Func<TInstance, CancellationToken, Task<T?>> Factory { get; set; }

    [Parameter]
    public required RenderFragment<T> ChildContent { get; set; }

    [CascadingParameter]
    public required Task<AuthenticationState> State { get; set; }

    [Parameter]
    public virtual RenderFragment NotFoundTemplate { get; set; } = DefaultNotFoundTemplate.Default;

    protected override async ValueTask<T?> GetContent() => await Factory(Instance, Stop).Off();

}