@inherits Templates.ActiveContentTemplateComponentBase<TValue>

@using DragonSpark.Model.Selection
@using DragonSpark.Model.Results
@using DragonSpark.Compose

@typeparam TValue

<ResultingContentView T="TValue" Content="@_content" UpdateMonitor="@_content.Condition"
                      ForceRender="@ForceRender"
                      ChildContent="@ChildContent"
                      LoadingTemplate="@LoadingTemplate"
                      NotFoundTemplate="@NotFoundTemplate"
                      ExceptionTemplate="@ExceptionTemplate"
                      ContentTemplate="@ContentTemplate"
                      Rendered="@Rendered"
                      Refreshed="@Refreshed"
/>

@code {
    readonly Switch        _assign  = new();
    IActiveContent<TValue> _content = null!;

    [Parameter]
    public ISelect<IActivityReceiver, IActiveContent<TValue>> Input
    {
        get => _input;
        set
        {
            if (_input != value)
            {
                _input = value;
                _assign.Up();
            }
        }
    }	ISelect<IActivityReceiver, IActiveContent<TValue>> _input = null!;

    [Parameter]
    public bool ForceRender { get; set; }

    [Parameter]
    public string CssClass { get; set; } = string.Empty;

    [Parameter]
    public EventCallback<TValue> Rendered { get; set; }

    [Parameter]
    public EventCallback<TValue> Refreshed { get; set; }

    [CascadingParameter]
    IActivityReceiver Receiver { get; set; } = null!;

    protected override void OnParametersSet()
    {
        if (_assign.Down())
        {
            _content = _input.Get(Receiver);
        }
        base.OnParametersSet();
    }

}
