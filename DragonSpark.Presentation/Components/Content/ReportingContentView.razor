@using DragonSpark.Compose
@using DragonSpark.Model.Operations
@using DragonSpark.Application.Diagnostics
@using DragonSpark.Application
@typeparam TValue

@inherits DragonSpark.Presentation.Components.Content.ActiveContentTemplateComponentBase<TValue>

<ResultingContentView Content="@Subject"
					  ChildContent="@ChildContent"
					  LoadingTemplate="@LoadingTemplate"
					  NotAssignedTemplate="@NotAssignedTemplate"
					  ExceptionTemplate="@ExceptionTemplate"
					  />

@code
{

	[Parameter]
	public IActiveContent<TValue>? Content
	{
		get => _content;
		set
		{
			if (_content != value)
			{
				_content = value;
				Subject = null;
			}
		}
	}	IActiveContent<TValue>? _content;

	[Parameter]
	public Type? ReportedType { get; set; }

	IResulting<TValue?>? Subject { get; set; }

	protected override void OnParametersSet()
	{
		base.OnParametersSet();
		Subject ??= Content != null ? DetermineSubject(Content) : null;
	}

	IResulting<TValue?> DetermineSubject(IActiveContent<TValue> content)
		=> content.Then().Handle(Exceptions, ReportedType ?? GetType()).Out();

}