@using DragonSpark.Application.Entities.Queries.Runtime.Shape
@using DragonSpark.Compose
@typeparam T

@ChildContent(Current.Verify())

@code {

	[Parameter]
	public IEvaluate<T> Input
	{
		get => _input;
		set
		{
			if (_input != value)
			{
				_input = value;
				Current = null;
			}
		}

	}

	[Parameter]
	public bool IncludeTotalCount
	{
		get => _includeTotalCount;
		set
		{
			if (_includeTotalCount != value)
			{
				_includeTotalCount = value;
				Current = null;
			}
		}
	}

	[Parameter]
	public string? OrderBy
	{
		get => _orderBy;
		set
		{
			if (_orderBy != value)
			{
				_orderBy = value;
				Current = null;
			}
		}
	}

	[Parameter]
	public string? Filter
	{
		get => _filter;
		set
		{
			if (_filter != value)
			{
				_filter = value;
				Current = null;
			}
		}
	}

	[Parameter]
	public Partition? Partition
	{
		get => _partition;
		set
		{
			if (_partition != value)
			{
				_partition = value;
				Current = null;
			}
		}

	}

	Current<T>? Current { get; set; }

	protected override async Task OnParametersSetAsync()
	{
		Current ??= await Input.Await(new() { Filter = Filter, OrderBy = OrderBy, IncludeTotalCount = IncludeTotalCount, Partition = Partition });
	}

	[Parameter]
	public RenderFragment<Current<T>> ChildContent { get; set; } = default!;

	IEvaluate<T> _input = default!;
	bool _includeTotalCount;
	string? _orderBy;
	string? _filter;
	Partition? _partition;
}