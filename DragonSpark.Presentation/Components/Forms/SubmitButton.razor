@using JetBrains.Annotations
@* ReSharper disable once ArrangeRedundantParentheses *@
<ButtonComponent Text="@Text" Icon="@Icon" ButtonType="ButtonType.Submit" Disabled="@(!Monitor.IsValid)"/>

@code {

    Action _changed;
    EditContext _editContext;

    [Parameter]
    public string Icon { get; [UsedImplicitly] set; }

    [Parameter]
    public string Text { get; [UsedImplicitly] set; }

    [CascadingParameter]
    OperationMonitor Monitor { get; [UsedImplicitly] set; }

    [CascadingParameter, UsedImplicitly]
    EditContext EditContext
    {
        get => _editContext;
        set
        {
            if (_editContext != value)
            {
                if (_editContext != null)
                {
                    _editContext.OnValidationStateChanged -= Changed;
                }

                if ((_editContext = value) != null)
                {
                    EditContext.OnValidationStateChanged += Changed;
                }
            }
        }
    }

    protected override void OnInitialized()
    {
        _changed = StateHasChanged;
    }

    void Changed(object sender, EventArgs e)
    {
        InvokeAsync(_changed);
    }
}