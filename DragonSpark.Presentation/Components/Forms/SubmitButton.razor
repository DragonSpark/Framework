@using JetBrains.Annotations
@* ReSharper disable once ArrangeRedundantParentheses *@
<ButtonComponent Text="@Text" Icon="@Icon" ButtonType="ButtonType.Submit" Disabled="@(!Operations.IsValid)"/>

@code {

    Action _changed = default!;
    EditContext _editContext = default!;

    [Parameter]
    public string Icon { get; [UsedImplicitly] set; } = default!;

    [Parameter]
    public string Text { get; [UsedImplicitly] set; } = default!;

    [CascadingParameter]
    EditOperationContext Operations { get; [UsedImplicitly] set; } = default!;

    [CascadingParameter, UsedImplicitly]
    EditContext EditContext
    {
        get => _editContext;
        set
        {
            if (_editContext != value)
            {
                if (_editContext != null)
                {
                    _editContext.OnValidationStateChanged -= Changed!;
                }

                if ((_editContext = value) != null)
                {
                    EditContext.OnValidationStateChanged += Changed!;
                }
            }
        }
    }

    protected override void OnInitialized()
    {
        _changed = StateHasChanged;
    }

    void Changed(object sender, EventArgs e)
    {
        InvokeAsync(_changed);
    }
}