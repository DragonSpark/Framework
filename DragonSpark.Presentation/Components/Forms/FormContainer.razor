@using JetBrains.Annotations
@typeparam TItem

    <Form @ref="_form" TItem="TItem" Data="Source" Submit="OnSubmit">
        <EditOperationContext @ref="_operations" ChildContent="@ChildContent(Source)" />
    </Form>

@code
{
    [UsedImplicitly]
    EditOperationContext _operations = default!;

    [UsedImplicitly]
    Form<TItem> _form = default!;

    [Parameter]
    public RenderFragment<TItem> ChildContent { get; set; } = default!;

    [Parameter]
    public TItem Source { get; set; } = default!;

    [Parameter]
    public EventCallback<TItem> Submit { get; set; }

    [UsedImplicitly]
    async Task OnSubmit(TItem parameter)
    {
        var valid = await _operations.Validate();
        if (valid)
        {
            await Submit.InvokeAsync(parameter);
        }
        else
        {
            await _form.InvalidSubmit.InvokeAsync(new FormInvalidSubmitEventArgs
            {
                Errors = _form.EditContext.GetValidationMessages()
            });
        }
    }
}