@using DragonSpark.Compose
@using DragonSpark.Presentation.Components.Eventing

@typeparam T where T : class

@inherits ModelPersistenceComponentBase<T>

<HandlerView T="LoadModelMessage" Received="@Handle" />
<HandlerView T="SaveModelMessage" Received="@Handle" />

@code {

    EventCallback _load;
    protected override void OnInitialized()
    {
        _load = Start.A.Callback(LoadContent).UpdateActivity(Receiver);
        base.OnInitialized();
    }

    Task Handle(SaveModelMessage message) => message.Subject == Model ? SaveContent() : Task.CompletedTask;

    Task Handle(LoadModelMessage message) => message.Subject == Model ? _load.Invoke() : Task.CompletedTask;
}