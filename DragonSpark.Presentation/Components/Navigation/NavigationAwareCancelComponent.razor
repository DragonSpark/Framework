@using DragonSpark.Application.AspNet.Runtime.Operations
@using System.Threading

@inject IScopedToken Session

@implements IDisposable

<CascadingValue IsFixed="true" Value="@_combined.Token" ChildContent="@ChildContent" />

@code {
    readonly CancellationTokenSource _source   = new();
    CancellationTokenSource          _combined = null!;

    [Parameter]
    public required RenderFragment ChildContent { get; set; }

    protected override void OnInitialized()
    {
        _combined = CancellationTokenSource.CreateLinkedTokenSource(Session.Get(), _source.Token);
        base.OnInitialized();
    }

    public void Dispose()
    {
        _source.Cancel();
        _source.Dispose();
    }
}
