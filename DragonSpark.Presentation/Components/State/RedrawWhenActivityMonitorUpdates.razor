@using DragonSpark.Compose
@using DragonSpark.Model.Results

<DragonSpark.Presentation.Components.Eventing.HandlerView T="ActivityUpdatedMessage" Received="@_update" />

@ChildContent(Monitor?.Active ?? false)

@code {
    readonly Switch _active = new();

    EventCallback<ActivityUpdatedMessage> _update;

    protected override void OnInitialized()
    {
        _update = Start.A.Callback<ActivityUpdatedMessage>(OnUpdate).Hide();
        base.OnInitialized();
    }

    [Parameter]
    public RenderFragment<bool> ChildContent { get; set; } = null!;

    [CascadingParameter] IActivityMonitor? Monitor { get; set; }

    Task OnUpdate(ActivityUpdatedMessage parameter)
    {
        var (owner, active, force) = parameter;
        if (owner == Monitor && (_active.Assign(active) || force))
        {
            StateHasChanged();
        }
        return Task.CompletedTask;
    }

}
